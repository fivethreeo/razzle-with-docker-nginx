version: "3.7"

services:
  nginx:
    restart: always
    build:
      target: nginx_development
      context: .
      dockerfile: Dockerfile

    depends_on:
      - razzle

    environment:
      VIRTUAL_HOST: ${VIRTUAL_HOST:?Host required}
      LETSENCRYPT_HOST: ${VIRTUAL_HOST:?Host required}

    networks:
      - docker_default

  razzle:
    restart: always
    build:
      target: razzle_development
      context: .
      dockerfile: Dockerfile

    environment:
      PUBLIC_HOST: ${VIRTUAL_HOST:?Host required}
      PUBLIC_PORT: ${PUBLIC_PORT:-}
      PUBLIC_SCHEME: ${PUBLIC_SCHEME:-https}
      RAZZLE_DEV: "true"

    networks:
      - docker_default

    volumes:
      - ./razzle/src:/code/src
      - ./razzle/public:/code/public
      - ./razzle/razzle.config.js:/code/razzle.config.js
      # - ./razzle/.babelrc:/code/.babelrc
      # - ./razzle/.eslintrc.js:/code/.eslintrc.js

networks:
  docker_default:
    external: true
    name: docker_default
